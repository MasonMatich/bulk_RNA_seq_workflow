---
title: "GO gene set enrichment analysis"
author: "Mason Matich"
date: "`r Sys.Date()`"
output: 
  html_document2:
    toc: TRUE
    toc_depth: 3
    toc_float: TRUE
    number_sections: FALSE
---

# Setup {.title}

Many of the figures and analysis methodology were based off of this tutorial from NYU.
https://learn.gencore.bio.nyu.edu/rna-seq-analysis/gene-set-enrichment-analysis/

```{r setup, warning=FALSE, message=FALSE, results='hide'}
## Library Preparation
library(clusterProfiler)
library(ReactomePA)
library(DESeq2)
library(dplyr)
library(tidyverse)
library(presto)
library(ashr)
library(GOSemSim)
library(org.Ce.eg.db)
library(bookdown)
library(knitr)
library(DT)
library(htmltools)
library(kableExtra)
```

```{r}
# Call functions
source("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/translateBioIDs.R")
source("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/callClusterProfilerFunc.R")
source("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/compileOntologyReport.R")
source("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/emptyTableMessage.R")
```

## Function called for Analysis {.tabset .tabset-pills}
```{r process_file, echo=FALSE, warning=FALSE, message=FALSE}
processFile = function(filepath) {
  # Open File
  con = file(filepath, "r")
  
  cat("\n\n```r\n") # open coding container for vis
  while ( TRUE ) {
    line = readLines(con, n = 1)
    if ( length(line) == 0 ) {
      break
    }
    cat(sprintf("%s \n", line))
  }
  close(con)
  cat("")
  cat("\n\n``` \n\n") # close coding container for vis
}
```

```{r report_functions, echo=FALSE, warning=FALSE, message=FALSE, results='asis'}
cat("### compileOntologyReport.R")
cat(processFile("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/compileOntologyReport.R"))

cat("### translateBioIDs.R")
cat(processFile("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/translateBioIDs.R"))

cat("### callClusterProfilerFunc.R")
cat(processFile("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/scripts/callClusterProfilerFunc.R"))
```

## Read in Data
```{r read_in_data}
# Lysate
lys <- readRDS("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/intermediate_data/deseq2_dds_objects/lotr1_isolatedStrain_Lysate_BatchCor_dds.rds")

# Polysome
ply <- readRDS("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/intermediate_data/deseq2_dds_objects/lotr1_isolatedStrain_Polysome_BatchCor_dds.rds")
```

## LOTR-1 Mutants
```{r print_mutants, warning=FALSE, message=FALSE, echo=FALSE}
knitr::include_graphics("~/Documents/research_labs/mdibl_fall_2025/updike_lotr1_go_analysis/figures/lotr-1_mutants.png")
```


## Get DESeq2 Results
```{r get_DESeq_results, warning=FALSE, message=FALSE}
# Full KO vs WT
full_vs_wt.lys <- results(lys, name = "strain_DUP207_vs_DUP167")
full_vs_wt.ply <- results(ply, name = "strain_DUP207_vs_DUP167")

# Tudor KO vs WT 
tudor_vs_wt.lys <- results(lys, name = "strain_DUP185_vs_DUP167")
tudor_vs_wt.ply <- results(ply, name = "strain_DUP185_vs_DUP167")

# LOTUS KO vs WT
lotus_vs_wt.lys <- results(lys, name = "strain_DUP217_vs_DUP167")
lotus_vs_wt.ply <- results(ply, name = "strain_DUP217_vs_DUP167")
```

```{r datatable_dependencies, include=FALSE}
# Doesn't render in bookdown, but loades dependences needed to render other datatables
datatable(data.frame(x = c(1), y = c(1)), extensions = 'Buttons', rownames = FALSE,options = list(buttons = c('copy', 'csv', 'excel', 'pdf')))
```

```{r full_vs_wt.lys, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # Full LOTR-1 KO vs WT Lysate fraction
compileOntologyReport(
  result.obj = full_vs_wt.lys, 
  strain = "Full LOTR-1 KO vs WT", 
  fraction = "Lysate",
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r full_vs_wt.ply, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # Full LOTR-1 KO vs WT Polysome fraction
compileOntologyReport(
  result.obj = full_vs_wt.ply, 
  strain = "Full LOTR-1 KO vs WT", 
  fraction = "Polysome",
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r tudor_vs_wt.lys, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # Tudor LOTR-1 KO vs WT Lysate fraction
compileOntologyReport(
  result.obj = tudor_vs_wt.lys, 
  strain = "Tudor LOTR-1 KO vs WT", 
  fraction = "Lysate", 
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r tudor_vs_wt.ply, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # Tudor LOTR-1 KO vs WT Polysome fraction
compileOntologyReport(
  result.obj = tudor_vs_wt.ply, 
  strain = "Tudor LOTR-1 KO vs WT", 
  fraction = "Polysome",
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r lotus_vs_wt.lys, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # LOTUS LOTR-1 KO vs WT Lysate fraction
compileOntologyReport(
  result.obj = lotus_vs_wt.lys, 
  strain = "LOTUS LOTR-1 KO vs WT", 
  fraction = "Lysate",
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r lotus_vs_wt.ply, results='asis', warning=FALSE, message=FALSE, echo=FALSE}
# # LOTUS LOTR-1 KO vs WT Polysome fraction
compileOntologyReport(
  result.obj = lotus_vs_wt.ply, 
  strain = "LOTUS LOTR-1 KO vs WT", 
  fraction = "Polysome",
  l2fc_filter = 0.8,
  padj_filter = 0.1)
```

```{r cleanup, warning=FALSE, message=FALSE, echo=FALSE}
rm(lys, ply, full_vs_wt.lys, full_vs_wt.ply, tudor_vs_wt.lys, tudor_vs_wt.ply, lotus_vs_wt.lys, lotus_vs_wt.ply, callClusterProfilerFunc, compileOntologyReport, translateBioIDs, emptyTableMessage, processFile)
```

